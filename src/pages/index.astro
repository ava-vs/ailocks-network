---
import Layout from '../layouts/Layout.astro';
import Header from '../components/Header';
import ChatInterface from '../components/Chat/ChatInterface';
import IntentPanel from '../components/Sidebar/IntentPanel';
import NavigationSidebar from '../components/Sidebar/NavigationSidebar';
import StatusBar from '../components/StatusBar.tsx';

// Get detected language from edge function
const detectedLanguage = Astro.request.headers.get('X-Detected-Language') || 'en';

// Get user location from edge function
const userLocationHeader = Astro.request.headers.get('X-User-Location');
let userLocationData = {
  country: 'US',
  city: 'New York',
  timezone: 'America/New_York',
  region: 'NY',
  latitude: 40.7128,
  longitude: -74.0060,
  isDefault: true
};

if (userLocationHeader) {
  try {
    userLocationData = JSON.parse(userLocationHeader);
  } catch (error) {
    console.warn('Failed to parse user location header:', error);
  }
}
---

<Layout title="Ailocks: Ai2Ai Network - AI Collaboration Platform">
  <!-- Add detected language and user location as meta tags for client-side access -->
  <meta name="detected-language" content={detectedLanguage} slot="head" />
  <meta name="user-location" content={JSON.stringify(userLocationData)} slot="head" />
  
  <div class="flex flex-col h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900">
    <!-- Header - React Island -->
    <Header client:load />

    <!-- Main Content -->
    <div class="flex flex-1 overflow-hidden min-h-0">
      <!-- Left Navigation Sidebar - React Island -->
      <NavigationSidebar client:load />

      <!-- Chat Interface - React Island -->
      <div class="flex-1 min-w-0 overflow-hidden">
        <ChatInterface client:load />
      </div>

      <!-- Right Intent Panel - React Island -->
      <IntentPanel client:load />
    </div>

    <!-- Dynamic Status Bar - React Island -->
    <StatusBar client:load />
  </div>
</Layout>

<style>
  /* Custom scrollbar styles */
  :global(.scrollbar-thin) {
    scrollbar-width: thin;
  }
  
  :global(.scrollbar-thumb-white\/10::-webkit-scrollbar-thumb) {
    background-color: rgba(255, 255, 255, 0.1);
    border-radius: 6px;
  }
  
  :global(.scrollbar-track-transparent::-webkit-scrollbar-track) {
    background-color: transparent;
  }
  
  :global(.scrollbar-thin::-webkit-scrollbar) {
    width: 6px;
  }
</style>
</Layout>